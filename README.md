# Mining Analytics Blocks

Агрегатор статистики майнинга Bitcoin, который анализирует блоки и coinbase-транзакции для извлечения информации о майнерах.

## Описание

Этот проект представляет собой инструмент для анализа майнинговой активности в сети Bitcoin. Он получает данные из Mempool.space API и анализирует coinbase-транзакции для определения:

- Предполагаемого майнера блока
- Высоты блока
- Времени блока
- Распределения наград по адресам
- Общей суммы наград

## Функциональность

### Основные возможности:

1. **Получение данных из Mempool.space API**:
   - Загрузка последних блоков Bitcoin
   - Извлечение coinbase-транзакций из блоков
   - Получение детальной информации о транзакциях

2. **Парсинг coinbase-транзакций**:
   - Анализ scriptSig в coinbase-транзакциях
   - Извлечение высоты блока
   - Определение предполагаемого майнера (по текстовой метке в coinbase)
   - Получение временной метки блока

3. **Анализ наград**:
   - Поиск основного выхода с максимальной наградой
   - Получение всех наград и их адресов
   - Расчет общей суммы наград

## Архитектура

Проект использует архитектуру с разделением на слои:

```
src/
├── config/          # Конфигурация приложения
├── domain/          # Модели данных (блоки, транзакции)
├── infrastructure/  # HTTP-клиент для работы с API
├── utils/           # Утилиты (парсинг Bitcoin скриптов)
└── main.rs          # Точка входа
```

### Модули:

- **Domain**: Модели данных для блоков и транзакций
- **Infrastructure**: HTTP-клиент для работы с API
- **Utils**: Парсинг Bitcoin скриптов
- **Config**: Конфигурация приложения

## Установка и запуск

### Требования

- Rust 1.70+
- Cargo

### Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd mining-analytics_blocks
```

2. Установите зависимости:
```bash
cargo build
```

3. Запустите приложение:
```bash
cargo run
```

### Конфигурация

1. Скопируйте файл конфигурации:
```bash
cp config/config-example.json config/config.json
```

2. При необходимости отредактируйте `config/config.json`:

```json
{
  "api_url": "https://mempool.space/api/"
}
```

**Примечание**: Файл `config/config.json` исключен из git через `.gitignore` для безопасности.

## Использование

После запуска приложение:

1. Загружает последние блоки из API
2. Извлекает coinbase-транзакцию из первого блока
3. Парсит scriptSig для получения информации о майнере
4. Анализирует распределение наград
5. Выводит результаты в лог

### Пример вывода:

```
INFO: Full reward: 313408731
INFO: Main reward: Some(313408185)
INFO: Main reward address: Some(Some("3G7jcEELKh38L6kaSV8K35pTqsh5bgZW2D"))
INFO: All rewards and addresses: [(546, "35BpUGMm4Cod9dVWwdTJK1A4RDsCE3zTVC"), (313408185, "3G7jcEELKh38L6kaSV8K35pTqsh5bgZW2D")]
INFO: Guessed miner: binance/994
INFO: Block height: 907905
INFO: Block time: 1753936229
```

## Ключевые методы

### Transaction

- `get_main_reward_vout()` - Находит основной выход с максимальной наградой
- `get_main_reward_address()` - Получает адрес основного выхода
- `get_main_reward_value()` - Получает значение основной награды
- `get_full_reward_value()` - Рассчитывает общую сумму всех наград
- `get_rewards_value_and_address()` - Получает все награды и их адреса

### ParsedScriptSig

- `block_height` - Высота блока
- `guessed_miner` - Предполагаемый майнер
- `timestamp_sec` - Временная метка (опционально)

## Зависимости

Основные зависимости:

- `tokio` - Асинхронный runtime
- `reqwest` - HTTP-клиент
- `serde` - Сериализация/десериализация
- `bitcoin` - Работа с Bitcoin протоколом
- `tracing` - Структурированное логирование
- `anyhow` - Обработка ошибок

## Лицензия

MIT License

## Автор

Разработано для анализа майнинговой статистики Bitcoin. 